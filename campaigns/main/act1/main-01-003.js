// Mission: Industrial Sabotage
// Campaign: Main Campaign
// Act: 1 - Beginning Operations
// Mission: 003

(function() {
    const mission = {
        id: 'main-01-003',
        campaign: 'main',
        act: 1,
        missionNumber: 3,

        name: 'Industrial Sabotage',
        title: 'Sabotage Operation',
        description: 'Destroy Nexus Corp\'s secret weapons manufacturing facility in Tokyo.',
        briefing: 'We\'ve traced Project Convergence to its source - this industrial complex in Tokyo. It\'s registered as an independent arms manufacturer, but it\'s actually a Nexus Corp shell company. This is where they\'re building the AI-controlled weapons the government is funding. We can\'t let this continue. Plant explosives at the production lines and destroy their manufacturing capability. Dr. Chen, a former Nexus engineer, is inside and willing to help - she knows where to hit them hardest.',
        storyContext: 'Time to strike back. Destroying this facility will cripple Nexus Corp\'s weapons production.',
        region: 'asia',
        location: 'Tokyo',

        agents: {
            max: 5,
            required: 2,
            recommended: 4
        },

        map: {
            type: 'industrial',
            name: 'Industrial Complex',
            width: 100,
            height: 80,
            spawn: { x: 50, y: 78 },
            extraction: { x: 50, y: 2 },

            generation: {
                baseType: 'walls',

                factoryFloor: { x1: 20, y1: 20, x2: 79, y2: 59 },

                loadingDocks: [
                    { x1: 1, y1: 30, x2: 20, y2: 50 },
                    { x1: 80, y1: 30, x2: 99, y2: 50 }
                ],

                catwalks: [
                    { x1: 25, y1: 15, x2: 75, y2: 17 },
                    { x1: 25, y1: 63, x2: 75, y2: 65 }
                ],

                assemblyLines: [
                    { x: 30, y: 30, width: 40, height: 3 },
                    { x: 30, y: 40, width: 40, height: 3 },
                    { x: 30, y: 50, width: 40, height: 3 }
                ],

                controlRooms: [
                    { x: 10, y: 10, width: 15, height: 10 },
                    { x: 75, y: 10, width: 15, height: 10 },
                    { x: 45, y: 65, width: 10, height: 10 }
                ]
            },

            embedded: {
                tiles: [
                    "################################################.......###.####.#.##################################",
                    "################################################.....##################.#########.###############.##",
                    "################################################.....###########.###################################",
                    "#####################################.##########.....###################.###########################",
                    "##################################.#####.#######.....############.###################.##############",
                    "##################################.############.##..#######.########################################",
                    "#################################.################..##..############################################",
                    "###################################.##############..##############.#################################",
                    "###################################################.##############..################################",
                    "############################################.######.################################################",
                    "##################################################..################################################",
                    "###########.............#########################...########################.............###########",
                    "###########.............#########################..#########################.............###########",
                    "###########.............#########################..#########################.............###########",
                    "###########.............########################...#########################.............###########",
                    "###########..............................................................................###########",
                    "###########..............................................................................###########",
                    "###########.............#................................................................###########",
                    "###########.............####################..###...########################.............###########",
                    "#################....#########################..#....#######################.#######################",
                    "#################....##########################.......##############################################",
                    "#################....##############################...##############################################",
                    "#################....######.#######################...##############################################",
                    "#################....#####.##...###############..#...#.#############################################",
                    "################.#...###.........###############.##....#############...#.######################..###",
                    "###################..###.####.#..#############........##############..#...########################.#",
                    "######################...####......################.....#############....###########################",
                    "#####################...#######...################....#############.#...############################",
                    "####################....######......#.############.....############.#...###########################.",
                    "#####################..#########......########........#################...##########################",
                    "#####################.#########....#..#######.#...#..#################....##########################",
                    "#####################.##########........########.....#################....##########################",
                    "####################..##########.....##..#######.....##################..#################.#########",
                    "####################..########............##.##......##################...##########################",
                    "####################..#########............##.#.....###################....#########################",
                    "###################...########..........#...#.......###################...##########################",
                    "###################...####.#.##...##.#..............####################...#########################",
                    "####################..####.#.#.....#####.............###################...#########################",
                    "###################......#.#......#######............###################.....####################.##",
                    "####################...........#.#.#######............##################.....#######################",
                    "####################..#..#.....###.#######........#...##################...#.#######################",
                    "####################..###.....######.#######..........###..##############....#######################",
                    "#####################..##....#########.######........###...###############...#######################",
                    "######################.################.######................############...#######################",
                    "#####################..#################.#####...................##########..#######################",
                    "#####################...#######################.............#...###########..##############.########",
                    "#####################...#########################................#.########..#######################",
                    "######################..#########################..................########..#########.#############",
                    "######################..####################.#####.................########..#######################",
                    "######################...##############################...###......########..#######################",
                    "######################...#######################.##.......#####..#..######...#######################",
                    "######################...#########################.........####.........##...#######################",
                    "######################....####################.###.........#####........##...#.#####################",
                    "#######################.#...####################.#####.....#####.............#######################",
                    "########################.........##################.##....########...........#######################",
                    "########################......#...##########.........#...#########....#....#########################",
                    "##########################........#########..........#..###########......###########################",
                    "##########################.......######.###..............############...############################",
                    "###########################...############.#..............###########.##############################",
                    "############################...##################.........#######.##################################",
                    "#############################..#################.....#....##########################################",
                    "##############################..#################....###############################################",
                    "##############################...#################.....#############.#.#############################",
                    "#########################...................................................########################",
                    "#########################...................................................########################",
                    "#########################...................................................########################",
                    "##############################################........#####################.########################",
                    "##############################################........##################.###########################",
                    "##############################################........##############################################",
                    "##############################################........##############################################",
                    "##############################################........##############################################",
                    "##############################################........########################.#####################",
                    "##############################################........#####################.########################",
                    "##############################################........#####################.#.######################",
                    "#################################################...#######################..#######################",
                    "#################################################...################################################",
                    "################################################.....###############################################",
                    "################################################.....###############################################",
                    "################################################.....###############################################",
                    "################################################.....###############################################"
                ], 
                spawn: { x: 50, y: 78 },
                extraction: { x: 50, y: 2 },
                items: [
                    { type: 'explosive', x: 35, y: 30, id: 0 },
                    { type: 'explosive', x: 50, y: 40, id: 1 },
                    { type: 'explosive', x: 65, y: 50, id: 2 }
                ],
                doors: [],
                coverCount: 100
            },

            explosiveTargets: [
                { x: 35, y: 30, planted: false, id: 0 },
                { x: 50, y: 40, planted: false, id: 1 },
                { x: 65, y: 50, planted: false, id: 2 }
            ],

            enemySpawns: [
                { x: 30, y: 25 }, { x: 70, y: 25 },
                { x: 30, y: 55 }, { x: 70, y: 55 },
                { x: 50, y: 30 }, { x: 50, y: 50 },
                { x: 25, y: 40 }, { x: 75, y: 40 },
                { x: 40, y: 35 }, { x: 60, y: 45 }
            ],

            coverPositions: 100
        },

        objectives: [
            {
                id: 'plant_explosives',
                type: 'interact',
                target: 'explosive',
                count: 3,
                required: true,
                description: 'Plant explosives at production lines',
                displayText: 'Plant explosives: {current}/{required}'
            },
            {
                id: 'survive_explosion',
                type: 'survive',
                duration: 60,
                required: true,
                description: 'Survive until explosives detonate',
                displayText: 'Survive: {remaining}s',
                triggerAfter: ['plant_explosives']
            },
            {
                id: 'avoid_civilians',
                type: 'custom',
                required: false,
                checkFunction: 'checkNoCivilianCasualties'
            },
            {
                id: 'keep_agents_alive',
                type: 'custom',
                required: false,
                checkFunction: 'checkAgentsAlive',
                minAgents: 2
            }
        ],

        enemies: {
            count: 10,
            types: ['guard', 'soldier', 'heavy'],
            waves: [
                { trigger: 'explosives_planted', count: 10, delay: 10 }
            ]
        },

        rewards: {
            credits: 3000,
            researchPoints: 100
        },

        // NPCs
        npcs: [
            {
                id: 'engineer',
                spawn: { x: 18, y: 22 },
                quests: ['sabotage_plan']
            }
        ]
    };

    if (typeof CampaignSystem !== 'undefined') {
        CampaignSystem.registerMission('main', 1, 'main-01-003', mission);
    }
    if (typeof window !== 'undefined') {
        window.CAMPAIGN_MISSIONS = window.CAMPAIGN_MISSIONS || {};
        window.CAMPAIGN_MISSIONS['main-01-003'] = mission;
    }
})();