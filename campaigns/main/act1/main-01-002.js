// Mission: Network Breach - Government Facility
// Campaign: Main Campaign
// Act: 1 - Beginning Operations
// Mission: 002

(function() {
    const mission = {
        id: 'main-01-002',
        campaign: 'main',
        act: 1,
        missionNumber: 2,

        name: 'Network Breach',
        title: 'Government Facility',
        description: 'Infiltrate the government research facility funding Nexus Corp\'s weapons program.',
        briefing: 'The intel from Nexus Corp was worse than we feared. They\'re not working alone - we found evidence of massive government funding flowing into something called "Project Convergence." This London facility is where the money trail leads. Break into their network and find out what Nexus is really building with taxpayer money. Be careful - government security is even tighter than corporate.',
        storyContext: 'The conspiracy deepens. Nexus Corp has powerful allies in government who are funding their secret weapons research.',
        region: 'europe',
        location: 'London',

        agents: {
            max: 4,
            required: 2,
            recommended: 3
        },

        map: {
            type: 'government',
            name: 'Government Research Facility',
            width: 90,
            height: 70,
            spawn: { x: 2, y: 68 },
            extraction: { x: 88, y: 2 },

            // Embedded map data - no procedural generation needed
            embedded: {
                tiles: [
                    "#################################################################################.........",
                    "#################################################################################.........",
                    "#################################################################################.........",
                    "#################################################################################.........",
                    "#################################################################################.........",
                    "##############################..########...........#########..##################..........",
                    "##############################..########...........#########..##################..########",
                    "##############################..########...........#########..##################..########",
                    "##############################..########...........#########..##################..########",
                    "##############################..########...........#########..##################..########",
                    "##########...........#########..########...........#########..########............########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########.....................#########",
                    "##########......................########...........#########.....................#########",
                    "##########......................##############..############..########...........#########",
                    "##########......................##############..############..########...........#########",
                    "##########...........####.####..##############..############..########...........#########",
                    "##########...........#########..##############..############..########...........#########",
                    "##########...........#########..##############..############..########...........#########",
                    "##############################..##############..############..############################",
                    "##############################..##############..############..############################",
                    "##############################..##############..############..############################",
                    "##############################..##############..############..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####.................................................................................####",
                    "#####.................................................................................####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "#####...........##############..###.....................####..#############...........####",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..###.....................####..############################",
                    "##############################..#############..#############..############################",
                    "##############################..#############..#############..############################",
                    "##############################..#############..#############..############################",
                    "##############################..#############..#############..############################",
                    "##########...........#########..#############..#############..########...........#########",
                    "##########...........#########..#############..#############..########...........#########",
                    "##########...........#########..#############..#############..########...........#########",
                    "##########...........#########..#############..#############..########...........#########",
                    "##########...........#########..#############..#############..########...........#########",
                    "##########......................########...........#########.....................#########",
                    "##########......................########...........#########.....................#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########...........#########..########...........#########..########...........#########",
                    "##########..##################..########...........#########..############################",
                    "##########..##################..########...........#########..############################",
                    "##########..##################..########...........#########..############################",
                    "##########..##################..########...........#########..############################",
                    "............############################...........#######################################",
                    "...........###############################################################################",
                    "...........###############################################################################",
                    "...........###############################################################################",
                    "...........###############################################################################"
                ], 
                spawn: { x: 2, y: 68 },
                extraction: { x: 88, y: 2 },
                items: [
                    { type: 'terminal', x: 15, y: 15, id: 0 },  // In top-left checkpoint
                    { type: 'terminal', x: 75, y: 15, id: 1 },  // In top-right checkpoint
                    { type: 'terminal', x: 45, y: 35, id: 2 }   // In central command center
                ],
                doors: [
                    { x: 21, y: 15, locked: false },  // Door to left checkpoint
                    { x: 69, y: 15, locked: false },  // Door to right checkpoint
                    { x: 34, y: 35, locked: true },   // Main door to command center (locked)
                    { x: 56, y: 35, locked: true },   // Back door to command center (locked)
                    { x: 45, y: 24, locked: false },  // North door to command center
                    { x: 45, y: 46, locked: false }   // South door to command center
                ],
                collectables: [
                    // Intel documents in checkpoint rooms
                    { type: 'collectable', x: 16, y: 16, id: 'intel_checkpoint1', name: 'Research Data', sprite: 'ðŸ“„', credits: 150 },
                    { type: 'collectable', x: 76, y: 16, id: 'intel_checkpoint2', name: 'Security Codes', sprite: 'ðŸ“„', credits: 150 },
                    // Credits cache in command center
                    { type: 'collectable', x: 44, y: 36, id: 'credits_command', name: 'Emergency Fund', sprite: 'ðŸ’°', credits: 300 },
                    // Medical supplies in corners
                    { type: 'collectable', x: 10, y: 60, id: 'medkit_1', name: 'First Aid Kit', sprite: 'ðŸ’Š', health: 50 },
                    { type: 'collectable', x: 80, y: 60, id: 'medkit_2', name: 'Medical Supplies', sprite: 'ðŸ’Š', health: 50 }
                ],
                coverCount: 80
            },

            // Terminals for hacking objective
            terminals: [
                { x: 15, y: 15, hacked: false, id: 0 },
                { x: 75, y: 15, hacked: false, id: 1 },
                { x: 45, y: 35, hacked: false, id: 2 }
            ],

            enemySpawns: [
                { x: 15, y: 15 },  // Guard at checkpoint 1
                { x: 75, y: 15 },  // Guard at checkpoint 2
                { x: 15, y: 55 },  // Guard at checkpoint 3
                { x: 75, y: 55 },  // Guard at checkpoint 4
                { x: 45, y: 35 },  // Guard in command center
                { x: 30, y: 35 },  // Patrol in left corridor
                { x: 60, y: 35 },  // Patrol in right corridor
                { x: 45, y: 10 }   // Guard at server room
            ],

            coverPositions: 80
        },

        objectives: [
            {
                id: 'hack_all_terminals',
                type: 'interact',
                target: 'terminal',
                count: 3,
                required: true,
                description: 'Hack 3 terminals',
                displayText: 'Terminals hacked: {current}/{required}'
            },
            {
                id: 'extract_data',
                type: 'reach',
                target: 'extraction',
                required: true,
                description: 'Extract data',
                displayText: 'Reach extraction point',
                triggerAfter: ['hack_all_terminals']
            },
            {
                id: 'avoid_civilians',
                type: 'custom',
                required: false,
                description: 'No civilian casualties',
                displayText: 'Clean operation: No civilian casualties',
                checkFunction: 'checkNoCivilianCasualties',
                rewards: { credits: 300, researchPoints: 10 }
            },
            {
                id: 'keep_agents_alive',
                type: 'custom',
                required: false,
                description: 'Keep at least 2 agents alive',
                displayText: 'Squad intact: 2+ agents alive',
                checkFunction: 'checkAgentsAlive',
                minAgents: 2,
                rewards: { credits: 500, researchPoints: 25 }
            }
        ],

        enemies: {
            count: 8,
            types: ['guard', 'soldier', 'heavy']
        },

        rewards: {
            credits: 2500,
            researchPoints: 75,
            worldControl: 2
        },

        // NPCs
        npcs: [
            {
                id: 'underground_hacker',
                spawn: { x: 10, y: 35 },  // In left office area
                quests: ['network_sabotage']
            }
        ]
    };

    if (typeof CampaignSystem !== 'undefined') {
        CampaignSystem.registerMission('main', 1, 'main-01-002', mission);
    }
    if (typeof window !== 'undefined') {
        window.CAMPAIGN_MISSIONS = window.CAMPAIGN_MISSIONS || {};
        window.CAMPAIGN_MISSIONS['main-01-002'] = mission;
    }
})();