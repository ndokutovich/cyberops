// Mission: Stealth Recon
// Campaign: Main Campaign
// Act: 1 - Beginning Operations
// Mission: 004

(function() {
    const mission = {
        id: 'main-01-004',
        campaign: 'main',
        act: 1,
        missionNumber: 4,

        name: 'Stealth Recon',
        title: 'Shadow Infiltration',
        description: 'Gather intelligence on Nexus Corp\'s main research compound without detection.',
        briefing: 'The Tokyo factory was just manufacturing - the real research happens at Nexus Corp\'s secure compound in Singapore. Before we can assault it, we need eyes inside. This is a pure reconnaissance mission: infiltrate the compound, hack their terminals for intel on Project Convergence, and get out without being detected. If they know we\'re coming, they\'ll move everything. Stealth is paramount - one alarm and the mission fails.',
        storyContext: 'Intelligence gathering before the final push. What you learn here will determine our assault strategy.',
        region: 'asia',
        location: 'Singapore',

        agents: {
            max: 5,
            required: 1,
            recommended: 3
        },

        map: {
            type: 'stealth',
            name: 'Enemy Compound',
            width: 70,
            height: 70,
            spawn: { x: 2, y: 68 },
            extraction: { x: 68, y: 2 },

            generation: {
                baseType: 'walls',

                // Outer perimeter
                perimeter: { x1: 5, y1: 5, x2: 64, y2: 64 },

                // Guard towers
                towers: [
                    { x: 10, y: 10, radius: 3 },
                    { x: 60, y: 10, radius: 3 },
                    { x: 10, y: 60, radius: 3 },
                    { x: 60, y: 60, radius: 3 }
                ],

                // Central building
                building: { x: 25, y: 25, width: 20, height: 20 },

                // Patrol paths
                paths: [
                    { x1: 15, y1: 15, x2: 55, y2: 15 },
                    { x1: 15, y1: 55, x2: 55, y2: 55 },
                    { x1: 15, y1: 15, x2: 15, y2: 55 },
                    { x1: 55, y1: 15, x2: 55, y2: 55 }
                ],

                // Clear areas
                clearAreas: [
                    { x1: 0, y1: 65, x2: 10, y2: 69 },
                    { x1: 65, y1: 0, x2: 69, y2: 5 }
                ]
            },

            embedded: {
                tiles: [
                    "#################################################################.....",
                    "#################################################################.....",
                    "#################################################################.....",
                    "#################################################################.....",
                    "#############################################################.##......",
                    "#############################################################.........",
                    "############################################################....######",
                    "##########.####################################.#..#...#.#.....#######",
                    "########.....#######################.....#...#.................#######",
                    "########.....#################..................................######",
                    "#######.......###########...#..........##....#....#.............######",
                    "########.........######............##.####.###############.....#######",
                    "########...........#.......###############################.....#######",
                    "##########.............################################.......########",
                    "###########...........##################################......########",
                    "############...#.....##################################..#...#########",
                    "############..........##################################...###########",
                    "#############.........##################################...###########",
                    "#############...........#########################...####...###########",
                    "###############.........#####################.#.....##.#...###########",
                    "################....#....###################.##...#.###.##..##########",
                    "##############.###.......#################...........######.##########",
                    "################.#.........###############.#..........################",
                    "###################........###############......#....#.###############",
                    "##################.#.......#############.#.....####.....##############",
                    "##################.#.........###########.#.......###....##############",
                    "##################.#........###########.#.....######....##############",
                    "####################.#.......########.##.......#####.....#############",
                    "#####################.#........##########.....######......############",
                    "#######################.........##..##........######.....#############",
                    "#######################..#........###.#...##.#######.##....###########",
                    "#########################........####......#.########.#.....##########",
                    "########################...................############....###########",
                    "########################.#..................#.#########......#########",
                    "#########################.#..............#.############.....##########",
                    "##########################.........#....##.#.###########.....#########",
                    "##############################............##############....##########",
                    "##############################.........#.################....#########",
                    "#################################....#.###################...#########",
                    "#########################################################...##########",
                    "#########################################################..#.#########",
                    "#########################################################....#########",
                    "########################################################.....#########",
                    "########################################################...#..########",
                    "#######################################################......#########",
                    "#######################################################....#.#########",
                    "################################################....##.....###########",
                    "#################################################.........############",
                    "###############################################...........############",
                    "##################.....#######################...........#############",
                    "###################.#....##########.#..##.#.###...#.....#..###########",
                    "##################...........#########.#..#####............###########",
                    "#################...............###..#...######.............##########",
                    "################.....................#.........................#######",
                    "###############................#..#.........................#..#######",
                    "##############...............#........#................#.......#######",
                    "#############.......###..#.#.##.#.##.....##..##............#.#########",
                    "##########.#......#.###.########.##...###########.####....##.#########",
                    "#####..#..........######################################.#.....#######",
                    "................##########################################.....#######",
                    "..............###########################################.......######",
                    ".............#############################################.....#######",
                    ".............#############################################.....#######",
                    "............################################################.#########",
                    "#...........##########################################################",
                    "...........###########################################################",
                    "...........###########################################################",
                    "...........###########################################################",
                    "...........###########################################################",
                    "...........###########################################################"
                ], 
                spawn: { x: 2, y: 68 },
                extraction: { x: 68, y: 2 },
                doors: [],
                coverCount: 50
            },

            // Terminals for stealth hacking
            terminals: [
                { x: 35, y: 35, hacked: false, id: 0 },
                { x: 15, y: 15, hacked: false, id: 1 },
                { x: 55, y: 55, hacked: false, id: 2 }
            ],

            enemySpawns: [
                { x: 20, y: 20 }, { x: 50, y: 20 },
                { x: 20, y: 50 }, { x: 50, y: 50 },
                { x: 35, y: 35 }
            ],

            coverPositions: 50
        },

        objectives: [
            {
                id: 'remain_undetected',
                type: 'custom',
                required: true,
                description: 'Remain undetected',
                displayText: 'Ghost Mode: Stay undetected',
                checkFunction: 'checkStealthObjective'
            },
            {
                id: 'gather_intel',
                type: 'interact',
                target: 'terminal',
                count: 3,
                required: true,
                description: 'Hack 3 terminals',
                displayText: 'Terminals hacked: {current}/{required}'
            },
            {
                id: 'extract',
                type: 'reach',
                target: { type: 'extraction' },
                required: true,
                description: 'Reach extraction point',
                displayText: 'Reach extraction point'
            },
            {
                id: 'pacifist',
                type: 'custom',
                required: false,
                description: 'Complete without killing anyone',
                displayText: 'Pacifist: Zero kills',
                checkFunction: 'checkPacifist',
                rewards: { credits: 800, researchPoints: 40 }
            },
            {
                id: 'keep_agents_alive',
                type: 'custom',
                required: false,
                description: 'Keep all agents alive',
                displayText: 'Perfect extraction: All agents alive',
                checkFunction: 'checkAgentsAlive',
                minAgents: 3,
                rewards: { credits: 600, researchPoints: 30 }
            }
        ],

        enemies: {
            count: 5,
            types: ['guard'],
            alertBehavior: 'aggressive'
        },

        rewards: {
            credits: 2500,
            researchPoints: 75,
            worldControl: 2
        },

        // NPCs
        npcs: [
            {
                id: 'escaped_subject',
                spawn: { x: 8, y: 55 },  // Near spawn, hiding
                quests: ['map_facility']
            },
            {
                id: 'security_tech',
                spawn: { x: 25, y: 30 },  // Near central building
                quests: ['security_gaps']
            },
            {
                id: 'underground_contact',
                spawn: { x: 55, y: 45 },  // Southeast area
                quests: ['resistance_prep']
            }
        ]
    };

    if (typeof CampaignSystem !== 'undefined') {
        CampaignSystem.registerMission('main', 1, 'main-01-004', mission);
    }
    if (typeof window !== 'undefined') {
        window.CAMPAIGN_MISSIONS = window.CAMPAIGN_MISSIONS || {};
        window.CAMPAIGN_MISSIONS['main-01-004'] = mission;
    }
})();