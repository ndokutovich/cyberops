<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Disable caching during development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#00ffff">
    <meta name="description" content="Lead your syndicate in tactical cyberpunk missions. Hack, fight, and dominate the corporate world.">

    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" sizes="16x16" href="assets/logo-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/logo-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/logo-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/logo-180.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <title>CyberOps: Syndicate</title>
    <link rel="stylesheet" href="cyberops-game.css">
    
    <!-- Three.js r180 Library - ES Module -->
    <script type="module" src="lib/three-loader.js"></script>
    
</head>
<body>
    <!-- Initial Start Screen -->
    <div id="initialScreen" class="initial-screen">
        <div class="initial-content">
            <div class="initial-logo">CyberOps: Syndicate</div>
            <div class="initial-subtitle">Tactical Cyberpunk Action</div>
            <div class="initial-description">
                Immerse yourself in a world of corporate espionage and tactical operations.
            </div>
            <button id="resetButton" class="reset-button">
                <span class="reset-icon">‚ö°</span>
                <span class="reset-text">START EXPERIENCE</span>
            </button>
            <div class="initial-hint">Click to begin your cyberpunk journey</div>
        </div>
        <div class="initial-bg-effects">
            <div class="bg-grid"></div>
            <div class="bg-particles"></div>
        </div>
    </div>

    <!-- Demoscene Attract Mode -->
    <div id="demoscene" class="demoscene-screen">
        <div class="demo-header">
            <div class="demo-title">CyberOps: Syndicate</div>
            <div class="demo-subtitle">--- CLASSIFIED INTEL BRIEFING ---</div>
        </div>
        
        <div class="demo-content">
            <div class="demo-panels">
                <!-- World Lore Panel -->
                <div class="demo-panel lore-panel">
                    <div class="panel-title">WORLD STATE ANALYSIS</div>
                    <div class="lore-text">
                        <div class="lore-section">
                            <span class="lore-header">YEAR 2087:</span><br>
                            Mega-corporations rule the world through digital dominance. 
                            The line between human and machine has blurred beyond recognition.
                        </div>
                        <div class="lore-section">
                            <span class="lore-header">THE SYNDICATE:</span><br>
                            An elite organization of cyber-operatives fighting for freedom 
                            in a world controlled by algorithmic oppression.
                        </div>
                        <div class="lore-section">
                            <span class="lore-header">YOUR MISSION:</span><br>
                            Lead tactical operations to reclaim human autonomy from 
                            the corporate digital overlords.
                        </div>
                    </div>
                </div>
                
                <!-- Game Features Panel -->
                <div class="demo-panel features-panel">
                    <div class="panel-title">OPERATION PARAMETERS</div>
                    <div class="features-list">
                        <div class="feature-item">
                            <span class="feature-icon">‚ö°</span>
                            <span class="feature-text">Isometric Tactical Combat</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üéØ</span>
                            <span class="feature-text">Strategic Agent Management</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üî¨</span>
                            <span class="feature-text">Research & Development</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üí∞</span>
                            <span class="feature-text">Resource Economy</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üåç</span>
                            <span class="feature-text">World Liberation Campaign</span>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Panel -->
                <div class="demo-panel stats-panel">
                    <div class="panel-title">GLOBAL STATISTICS</div>
                    <div class="global-stats">
                        <div class="stat-row">
                            <span class="stat-label">Corporate Control:</span>
                            <div class="stat-bar">
                                <div class="stat-fill corporate-fill"></div>
                            </div>
                            <span class="stat-value">87%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Human Resistance:</span>
                            <div class="stat-bar">
                                <div class="stat-fill resistance-fill"></div>
                            </div>
                            <span class="stat-value">13%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Active Syndicates:</span>
                            <div class="stat-bar">
                                <div class="stat-fill syndicate-fill"></div>
                            </div>
                            <span class="stat-value">0.7%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-footer">
            <div class="demo-controls">
                <div class="control-hint">CLICK ANYWHERE TO ACCESS MAIN TERMINAL</div>
                <div class="demo-credits">
                    <span class="credits-scroll">
                        NEXUS INTERACTIVE PRESENTS ‚Ä¢ CYBER DYNAMICS GAME STUDIO ‚Ä¢ 
                        FEATURING ADVANCED AI TACTICAL SYSTEMS ‚Ä¢ PROCEDURAL MISSION GENERATION ‚Ä¢ 
                        DYNAMIC WORLD STATE SIMULATION ‚Ä¢ 
                    </span>
                </div>
            </div>
        </div>
        
        <div class="demo-effects">
            <div class="scanning-lines"></div>
            <div class="data-streams">
                <div class="data-stream stream-1"></div>
                <div class="data-stream stream-2"></div>
                <div class="data-stream stream-3"></div>
            </div>
        </div>
    </div>

    <!-- Company Logo Splash -->
    <div id="companyLogo" class="splash-screen">
        <div class="logo-container">
            <div class="company-name">NEXUS INTERACTIVE</div>
            <div class="logo-subtitle">Presents</div>
        </div>
        <!-- <div class="skip-hint">Click to skip</div> -->
    </div>

    <!-- Game Studio Splash -->
    <div id="studioLogo" class="splash-screen">
        <div class="logo-container">
            <div class="studio-name">CYBER DYNAMICS</div>
            <div class="logo-subtitle">Game Studio</div>
        </div>
        <!-- <div class="skip-hint">Click to skip</div> -->
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="game-title beam-sweep">CyberOps: Syndicate</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <!-- <div class="skip-hint">Click to skip</div> -->
    </div>

        <!-- Audio element for unified menu music track -->
        <!-- 3D Engine - Three.js moved to head section to load earlier -->
        

        
        
        
        
        

        <!-- Audio elements removed - using dynamic audio loading via JavaScript -->

    <!-- Main Menu -->
    <div id="mainMenu">
        <!-- Background Effects (enhanced cyberpunk atmosphere) -->
        <div class="menu-bg-effects">
            <div class="menu-bg-grid"></div>
            <div class="menu-bg-particles"></div>
            <div class="menu-bg-sparks"></div>
            <div class="menu-circuit-pattern"></div>
            <div class="menu-hex-pattern"></div>
            <div class="menu-scanning-lines"></div>
            <div class="menu-glitch-overlay"></div>
            <div class="menu-data-streams">
                <div class="menu-data-stream stream-1"></div>
                <div class="menu-data-stream stream-2"></div>
                <div class="menu-data-stream stream-3"></div>
                <div class="menu-data-stream stream-4"></div>
                <div class="menu-data-stream stream-5"></div>
            </div>
            <div class="menu-neon-pulses">
                <div class="neon-pulse pulse-1"></div>
                <div class="neon-pulse pulse-2"></div>
                <div class="neon-pulse pulse-3"></div>
            </div>
            <div class="menu-holo-shimmer"></div>
            <div class="menu-status-indicators">
                <div class="status-indicator ind-1"></div>
                <div class="status-indicator ind-2"></div>
                <div class="status-indicator ind-3"></div>
            </div>
            <div class="menu-running-text">
                <div class="running-text-container">
                    <div class="running-text-line" id="runningText">
                        <span class="text-segment typing-text" data-text="NEXUS INTERACTIVE SYSTEMS">NEXUS INTERACTIVE SYSTEMS</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                        <span class="text-segment typing-text" data-text="TACTICAL OPERATIONS NETWORK ONLINE">TACTICAL OPERATIONS NETWORK ONLINE</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                        <span class="text-segment typing-text" data-text="SYNDICATE COMMAND INTERFACE v2.7">SYNDICATE COMMAND INTERFACE v2.7</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                        <span class="text-segment typing-text" data-text="NEURAL LINK ESTABLISHED">NEURAL LINK ESTABLISHED</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                        <span class="text-segment typing-text" data-text="QUANTUM ENCRYPTION ACTIVE">QUANTUM ENCRYPTION ACTIVE</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                        <span class="text-segment typing-text" data-text="CYBER WARFARE PROTOCOLS LOADED">CYBER WARFARE PROTOCOLS LOADED</span>
                        <span class="text-separator"> ‚Ä¢ </span>
                    </div>
                </div>
                <div class="terminal-cursor"></div>
            </div>
        </div>
        
        <!-- Original Menu Content -->
        <div class="menu-content">
            <div class="game-title">CyberOps: Syndicate</div>
            <div class="subtitle">Tactical Cyberpunk Action</div>
            <button class="menu-button" id="campaignButton" onclick="game.startCampaign()">START CAMPAIGN</button>
            <button class="menu-button" id="continueButton" onclick="game.continueCampaign()" style="display: none;">CONTINUE CAMPAIGN</button>
            <button class="menu-button" id="hubButton" onclick="game.showSyndicateHub()" style="display: none;">SYNDICATE HUB</button>
            <button class="menu-button" onclick="game.selectMission()">MISSION SELECT</button>
            <button class="menu-button" id="saveButton" onclick="game.saveGame()" style="display: none;">SAVE GAME</button>
            <button class="menu-button" id="loadButton" onclick="game.loadGame()" style="display: none;">LOAD GAME</button>
            <button class="menu-button" onclick="game.showSettings()">SETTINGS</button>
            <button class="menu-button" onclick="game.exitGame()">EXIT GAME</button>
        </div>
    </div>

    <!-- Syndicate Hub -->
    <div id="syndicateHub" class="hub-screen">
        <div class="hub-header">
            <div class="hub-title">üè¢ SYNDICATE HUB</div>
            <div class="hub-subtitle">Central Command & Operations</div>

<div class="world-control-indicator">
                <span>World Control: </span>
                <span id="worldControlPercent">15%</span>
                <div class="control-bar">
                    <div class="control-progress" id="controlProgress" style="width: 15%"></div>
                </div>
            </div>
        </div>

        <div class="hub-content">
            <!-- Left Panel: Operations -->
            <div class="hub-panel operations-panel">
                <div class="panel-header">üéØ OPERATIONS</div>
                <div class="panel-content">
                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('mission-select-hub'); } else if(game.showMissionsFromHub) { game.showMissionsFromHub(); } else { console.error('No mission selection available'); }">
                        <div class="card-icon">üé≠</div>
                        <div class="card-title">MISSIONS</div>
                        <div class="card-desc">Launch new operations</div>
                        <div class="card-status" id="missionStatus">2 Available</div>
                    </div>
                    
                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('agent-management'); } else { alert('Agent management not available'); }">
                        <div class="card-icon">üë•</div>
                        <div class="card-title">AGENTS</div>
                        <div class="card-desc">Hire & manage operatives</div>
                        <div class="card-status" id="agentStatus">4 Active</div>
                    </div>
                    
                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('research-lab'); } else { alert('Research lab not available'); }">
                        <div class="card-icon">üî¨</div>
                        <div class="card-title">RESEARCH</div>
                        <div class="card-desc">Upgrade capabilities</div>
                        <div class="card-status" id="researchStatus">2 Active</div>
                    </div>

                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('hall-of-glory'); } else if(game.showHallOfGlory) { game.showHallOfGlory(); } else { alert('Hall of Glory not available'); }">
                        <div class="card-icon">‚ö∞Ô∏è</div>
                        <div class="card-title">HALL OF GLORY</div>
                        <div class="card-desc">Remember the fallen</div>
                        <div class="card-status" id="fallenStatus">0 Heroes</div>
                    </div>
                </div>
            </div>
            
            <!-- Center Panel: Dashboard -->
            <div class="hub-panel dashboard-panel">
                <div class="panel-header">üìä COMMAND CENTER</div>
                <div class="panel-content">
                    <div class="dashboard-stats">
                        <div class="stat-group">
                            <div class="stat-item">
                                <div class="stat-label">Missions Complete</div>
                                <div class="stat-value" id="hubMissionsComplete">0/5</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Active Agents</div>
                                <div class="stat-value" id="hubActiveAgents">4</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Research Points</div>
                                <div class="stat-value" id="hubResearchPoints">150</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Credits</div>
                                <div class="stat-value" id="hubCredits">5000</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="world-map">
                        <div class="map-title">üåç GLOBAL INFLUENCE</div>
                        <div class="influence-regions">
                            <div class="region" data-region="north-america">
                                <span class="region-name">North America</span>
                                <span class="region-control">25%</span>
                            </div>
                            <div class="region" data-region="europe">
                                <span class="region-name">Europe</span>
                                <span class="region-control">10%</span>
                            </div>
                            <div class="region" data-region="asia">
                                <span class="region-name">Asia</span>
                                <span class="region-control">5%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Resources -->
            <div class="hub-panel resources-panel">
                <div class="panel-header">üõ°Ô∏è RESOURCES</div>
                <div class="panel-content">
                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('arsenal'); } else if(game.showEquipmentManagement) { game.showEquipmentManagement(); } else { alert('Arsenal not available'); }">
                        <div class="card-icon">üî´</div>
                        <div class="card-title">ARSENAL</div>
                        <div class="card-desc">Manage equipment</div>
                        <div class="card-status" id="arsenalStatus">8 Items</div>
                    </div>
                    
                    <div class="hub-card" onclick="if(game.dialogEngine) { game.dialogEngine.navigateTo('intel-missions'); } else { alert('Intel missions not available'); }">
                        <div class="card-icon">üì°</div>
                        <div class="card-title">INTEL</div>
                        <div class="card-desc">Surveillance & data</div>
                        <div class="card-status" id="intelStatus">3 Reports</div>
                    </div>

                    <div class="hub-card" onclick="if(game.dialogEngine && game.dialogEngine.navigateTo) { game.dialogEngine.navigateTo('character'); } else if(game.showCharacterSheet) { game.showCharacterSheet(); } else { alert('Character sheet not available'); }">
                        <div class="card-icon">üìä</div>
                        <div class="card-title">CHARACTER</div>
                        <div class="card-desc">View RPG stats</div>
                        <div class="card-status" id="characterStatus">Level 1</div>
                    </div>

                    <div class="hub-card" onclick="if(game.showWorldMap) { game.showWorldMap(); } else { alert('World map coming soon!'); }">
                        <div class="card-icon">üó∫Ô∏è</div>
                        <div class="card-title">WORLD MAP</div>
                        <div class="card-desc">Global operations</div>
                        <div class="card-status" id="worldMapStatus">L1 Access</div>
                    </div>
                </div>
        </div>
    </div>

        <div class="hub-footer">
            <button class="menu-button hub-button" onclick="game.startNextMission()" style="background: #2e7d32; font-size: 1.1em;">üéØ NEXT MISSION</button>
            <button class="menu-button hub-button" onclick="game.backToMainMenu()">MAIN MENU</button>
            <button class="menu-button hub-button" onclick="game.quickSave()">QUICK SAVE</button>
            <button class="menu-button hub-button" onclick="game.saveGame()">SAVE MANAGER</button>
        </div>
    </div>

    <!-- Mission Briefing -->
    <div id="missionBriefing">
        <div class="briefing-header">MISSION BRIEFING</div>
        <div class="briefing-content">
            <h3 id="missionTitle">Mission Title</h3>
            <p id="missionDesc">Mission description...</p>
            
            <h4 style="margin-top: 20px; color: #00ffff;">OBJECTIVES:</h4>
            <div id="objectivesList"></div>
            
            <h4 style="margin-top: 20px; color: #00ffff;">SELECT SQUAD:</h4>
            <div id="squadInfo" style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 5px; text-align: center;"></div>
            <div class="squad-selection" id="squadSelection"></div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="menu-button" onclick="game.backToMenuFromBriefing()">BACK</button>
            <button class="menu-button" onclick="game.startMission()">DEPLOY</button>
        </div>
    </div>

    <!-- Game Canvas (2D) -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- 3D Canvas Container -->
    <div id="game3DContainer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 90; display: none; pointer-events: none;">
        <!-- Three.js canvas will be inserted here -->
    </div>
    
    <!-- 3D Mode HUD -->
    <div id="game3DHUD" style="display: none;">
        <div class="crosshair">
            <div class="crosshair-dot"></div>
            <div class="crosshair-lines">
                <div class="h-line"></div>
                <div class="v-line"></div>
            </div>
        </div>
        <div class="mode-indicator" id="modeIndicator">TACTICAL</div>
        <div class="hint-text">üìç TAB to select agent | ‚å®Ô∏è E to switch camera | üéÆ WASD to move | üî´ Click to shoot</div>
        
        <!-- 3D HUD Elements -->
        <div class="hud3d-top">
            <div class="health-display-3d">HP: 100/100</div>
            <div class="ammo-display-3d">AMMO: ‚àû</div>
            <div class="objective-display-3d">Eliminate all hostiles</div>
        </div>
        
        <div class="agent-info-3d">
            <div class="agent-name-3d" id="agentName3D">Agent Selected</div>
            <div class="agent-class-3d" id="agentClass3D">Operative</div>
        </div>

        <!-- Minimap for 3D Mode -->
        <div class="minimap-3d">
            <div class="minimap-content-3d" id="minimapContent3D"></div>
        </div>

        <!-- Action Palette for 3D Mode -->
        <div class="action-bar-3d">
            <div class="action-button-3d" data-action="0">
                <span>üëÜ</span>
                <div class="action-label">Move</div>
                <div class="cooldown-overlay-3d" id="cooldown3d0"></div>
            </div>
            <div class="action-button-3d" data-action="1">
                <span>üéØ</span>
                <div class="action-label">Shoot</div>
                <div class="cooldown-overlay-3d" id="cooldown3d1"></div>
            </div>
            <div class="action-button-3d" data-action="2">
                <span>üí£</span>
                <div class="action-label">Grenade</div>
                <div class="cooldown-overlay-3d" id="cooldown3d2"></div>
            </div>
            <div class="action-button-3d" data-action="3">
                <span>üíª</span>
                <div class="action-label">Hack</div>
                <div class="cooldown-overlay-3d" id="cooldown3d3"></div>
            </div>
            <div class="action-button-3d" data-action="4">
                <span>üõ°Ô∏è</span>
                <div class="action-label">Shield</div>
                <div class="cooldown-overlay-3d" id="cooldown3d4"></div>
            </div>
        </div>

        <div class="action-hint-3d">Press R to cycle actions | Current: <span id="currentAction3D">Shoot</span></div>
    </div>

    <!-- Game HUD -->
    <div id="gameHUD">
        <div class="hud-top">
            <div class="mission-timer" id="missionTimer">00:00</div>
            <div class="objective-tracker" id="objectiveTracker">Loading...</div>
            <button class="pause-button" onclick="game.togglePause()">‚è∏</button>
        </div>

        <div class="squad-health" id="squadHealth"></div>

        <div class="minimap">
            <div class="minimap-content" id="minimapContent"></div>
        </div>

        <!-- Fog Toggle Button -->
        <div style="position: absolute; bottom: 210px; left: 20px;">
            <button class="fog-toggle-btn" onclick="game.toggleFogOfWar()" title="Toggle Fog of War (U)" style="
                background: rgba(100, 50, 150, 0.8);
                border: 2px solid #9966ff;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s;
                min-width: 120px;
            " id="fogBtn">
                üå´Ô∏è FOG: ON
            </button>
        </div>

        <!-- Team Commands -->
        <div class="team-commands" style="position: absolute; bottom: 150px; left: 20px; display: flex; gap: 10px;">
            <button class="team-command-btn" onclick="game.setTeamMode('hold')" title="Hold Position (H)" style="
                background: rgba(0, 100, 200, 0.8);
                border: 2px solid #00ffff;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s;
            " id="holdBtn">
                üö´ HOLD
            </button>
            <button class="team-command-btn" onclick="game.setTeamMode('patrol')" title="Patrol Area (P)" style="
                background: rgba(0, 150, 100, 0.8);
                border: 2px solid #00ff00;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s;
            " id="patrolBtn">
                üîÑ PATROL
            </button>
            <button class="team-command-btn" onclick="game.setTeamMode('follow')" title="Follow Leader (F)" style="
                background: rgba(150, 100, 0, 0.8);
                border: 2px solid #ffa500;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s;
            " id="followBtn">
                üë• FOLLOW
            </button>
        </div>

        <!-- Event Log -->
        <div class="event-log" style="
            position: absolute;
            top: 100px;
            right: 20px;
            width: 450px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff;
            border-radius: 5px;
            font-size: 12px;
            color: #fff;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        " id="eventLog">
            <div style="
                padding: 5px 10px;
                background: rgba(0, 255, 255, 0.1);
                border-bottom: 1px solid #00ffff;
                display: flex;
                justify-content: space-between;
                align-items: center;
                cursor: pointer;
            " onclick="game.toggleEventLog()">
                <div style="color: #00ffff; font-weight: bold;">MISSION LOG</div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span id="logModeIndicator" style="color: #888; font-size: 10px;">FULL</span>
                    <span id="logToggleIcon" style="color: #00ffff;">‚ñº</span>
                </div>
            </div>

            <!-- Compact mode: shows only last event -->
            <div id="eventLogCompact" style="
                padding: 8px 10px;
                display: none;
                color: #0ff;
                font-size: 11px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            ">
                <!-- Last event will be shown here -->
            </div>

            <!-- Full log mode -->
            <div id="eventLogFull" style="
                max-height: 180px;
                overflow-y: auto;
                padding: 10px;
            ">
                <div id="eventLogContent" style="display: flex; flex-direction: column-reverse;">
                    <!-- Events will be added here -->
                </div>
            </div>
        </div>

        <div class="action-bar">
            <div class="action-button" onclick="game.useAbilityForAllSelected(0)">
                <span>üëÜ</span>
                <div class="cooldown-overlay" id="cooldown0"></div>
            </div>
            <div class="action-button" onclick="game.useAbilityForAllSelected(1)">
                <span>üéØ</span>
                <div class="cooldown-overlay" id="cooldown1"></div>
            </div>
            <div class="action-button" onclick="game.useAbilityForAllSelected(2)">
                <span>üí£</span>
                <div class="cooldown-overlay" id="cooldown2"></div>
            </div>
            <div class="action-button" onclick="game.useAbilityForAllSelected(3)">
                <span>üíª</span>
                <div class="cooldown-overlay" id="cooldown3"></div>
            </div>
            <div class="action-button" onclick="game.useAbilityForAllSelected(4)">
                <span>üõ°Ô∏è</span>
                <div class="cooldown-overlay" id="cooldown4"></div>
            </div>
        </div>
    </div>

    <!-- Victory/Defeat Screen -->
    <div id="endScreen" class="end-screen">
        <div id="endTitle" class="end-title">MISSION COMPLETE</div>
        <div class="end-stats">
            <div class="stat-row">
                <span>Time:</span>
                <span id="endTime">00:00</span>
            </div>
            <div class="stat-row">
                <span>Enemies Defeated:</span>
                <span id="endEnemies">0</span>
            </div>
            <div class="stat-row">
                <span>Objectives:</span>
                <span id="endObjectives">0/0</span>
            </div>
            <div class="stat-row">
                <span>Squad Status:</span>
                <span id="endSquad">All Alive</span>
            </div>
        </div>
        <!-- Button removed - replaced by intermission dialog -->
    </div>

    <!-- Game Complete Screen -->
    <div id="gameCompleteScreen" class="game-complete-screen">
        <div class="complete-title">üéâ MISSION ACCOMPLISHED! üéâ</div>
        <div class="complete-content">
            <div class="complete-message">
                <h2>Congratulations, Commander!</h2>
                <p>You have successfully completed all available missions in CyberOps: Syndicate.</p>
                <p>The Syndicate threat has been neutralized, and the city is safe once again.</p>
            </div>
            <div class="final-stats">
                <h3>Final Campaign Statistics:</h3>
                <div class="stat-row">
                    <span>Missions Completed:</span>
                    <span id="finalMissions">2/2</span>
                </div>
                <div class="stat-row">
                    <span>Total Time:</span>
                    <span id="finalTime">00:00</span>
                </div>
                <div class="stat-row">
                    <span>Total Enemies Neutralized:</span>
                    <span id="finalEnemies">0</span>
                </div>
            </div>
        </div>
        <div class="complete-actions">
            <button class="menu-button" onclick="game.showCredits()">CREDITS</button>
            <button class="menu-button" onclick="game.restartCampaign()">PLAY AGAIN</button>
            <button class="menu-button" onclick="game.backToMainMenu()">MAIN MENU</button>
        </div>
    </div>

    <!-- Credits Screen -->
    <div id="creditsScreen" class="credits-screen">
        <div class="credits-title">CREDITS</div>
        <div class="credits-content">
            <div class="credits-section">
                <h3>Game Design & Development</h3>
                <p>CyberOps Development Team</p>
            </div>
            <div class="credits-section">
                <h3>Art & Graphics</h3>
                <p>Isometric Graphics Engine</p>
                <p>Cyberpunk UI Design</p>
            </div>
            <div class="credits-section">
                <h3>Special Thanks</h3>
                <p>To all the players who helped test and improve the game</p>
            </div>
            <div class="credits-section">
                <h3>More Content Coming Soon!</h3>
                <p>Stay tuned for additional missions, agents, and features</p>
            </div>
        </div>
        <button class="menu-button" onclick="game.backToMainMenu()">BACK TO MENU</button>
    </div>

    <!-- HUD Dialog System -->
    <div id="hudDialog" class="hud-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <div class="dialog-title" id="dialogTitle">SYSTEM MESSAGE</div>
                <div class="dialog-close" onclick="game.closeDialog()">[X]</div>
            </div>
            <div class="dialog-body" id="dialogBody">
                Message content goes here...
            </div>
            <div class="dialog-actions" id="dialogActions">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Mission Selection Dialog - Moved to declarative dialog system -->

    <!-- Save List Dialog -->
    <div id="saveListDialog" class="hud-dialog">
        <div class="dialog-content">
            <div class="dialog-header">
                <div class="dialog-title">üíæ SAVE GAMES</div>
                <div class="dialog-close" onclick="game.closeSaveList()">[X]</div>
            </div>
            <div class="dialog-body">
                <div id="saveListContent" style="max-height: 400px; overflow-y: auto;">
                    <!-- Save slots will be dynamically added here -->
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #00ffff;">
                    <button class="menu-button" onclick="game.createNewSave()" style="width: 100%; background: #1e3c72;">
                        ‚ûï CREATE NEW SAVE
                    </button>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="menu-button" onclick="game.closeSaveList()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Equipment Management Dialog -->
    <div id="equipmentDialog" class="hud-dialog">
        <div class="dialog-content" style="width: 90%; max-width: 1200px; height: 85vh; max-height: 700px;">
            <div class="dialog-header">
                <div class="dialog-title">üéØ EQUIPMENT MANAGEMENT</div>
                <div class="dialog-close" onclick="game.closeEquipmentDialog()">[X]</div>
            </div>
            <div class="dialog-body" style="display: flex; gap: 20px; height: calc(100% - 120px);">
                <!-- Left Panel: Agents -->
                <div style="flex: 1; min-width: 250px; display: flex; flex-direction: column;">
                    <h3 style="color: #00ffff; margin-bottom: 15px;">üë• SQUAD</h3>
                    <div id="equipmentAgentList" style="flex: 1; overflow-y: auto;">
                        <!-- Agent list will be populated here -->
                    </div>
                </div>

                <!-- Center Panel: Current Loadout -->
                <div style="flex: 1; min-width: 300px; display: flex; flex-direction: column;">
                    <h3 style="color: #00ffff; margin-bottom: 15px;">üéØ CURRENT LOADOUT</h3>
                    <div id="currentLoadout" style="background: rgba(0,255,255,0.05); padding: 15px; border-radius: 8px; flex: 1; overflow-y: auto;">
                        <div style="color: #888; text-align: center; padding: 20px;">Select an agent to view loadout</div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="color: #ffa500; margin-bottom: 10px;">üìä STATS PREVIEW</h4>
                        <div id="statsPreview" style="background: rgba(255,165,0,0.1); padding: 10px; border-radius: 5px;">
                            <!-- Stats will show here -->
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Inventory -->
                <div style="flex: 1.5; min-width: 350px; display: flex; flex-direction: column;">
                    <h3 style="color: #00ffff; margin-bottom: 15px;">üì¶ INVENTORY</h3>
                    <div style="margin-bottom: 10px;">
                        <button class="menu-button" onclick="game.showWeaponInventory()" style="margin-right: 5px;">üî´ Weapons</button>
                        <button class="menu-button" onclick="game.showEquipmentInventory()">üõ°Ô∏è Equipment</button>
                        <button class="menu-button" onclick="game.showShopInterface()" style="background: #2e7d32; margin-left: 10px;">üõí Shop</button>
                        <button class="menu-button" onclick="game.showSellInterface()" style="background: #8b4513; margin-left: 5px;">üí∞ Sell</button>
                    </div>
                    <div id="inventoryList" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px;">
                        <!-- Inventory items will be listed here -->
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(0,255,255,0.1); border-radius: 5px;">
                        <div style="color: #00ffff;">Credits: <span id="equipCredits">0</span></div>
                        <div style="color: #888; font-size: 0.9em; margin-top: 5px;">Inventory Value: <span id="inventoryValue">0</span></div>
                    </div>
                </div>
            </div>
            <div class="dialog-actions">
                <button class="menu-button" onclick="game.saveLoadouts()">SAVE LOADOUTS</button>
                <button class="menu-button" onclick="game.optimizeLoadouts()" style="background: #2e7d32;">AUTO-OPTIMIZE</button>
                <button class="menu-button" onclick="game.closeEquipmentDialog()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- Mission Intermission Dialog -->
    <div id="intermissionDialog" class="hud-dialog">
        <div class="dialog-content intermission-content">
            <div class="dialog-header">
                <div class="dialog-title" id="intermissionTitle">MISSION COMPLETE</div>
                <div class="dialog-close" onclick="game.closeIntermissionDialog()">[X]</div>
            </div>
            <div class="dialog-body">
                <div class="intermission-message" id="intermissionMessage">
                    <div class="status-icon">‚úÖ</div>
                    <div class="status-text">MISSION ACCOMPLISHED</div>
                </div>
                <div class="intermission-stats">
                    <div class="stat-row">
                        <span>Time:</span>
                        <span id="intermissionTime">00:00</span>
                    </div>
                    <div class="stat-row">
                        <span>Enemies Neutralized:</span>
                        <span id="intermissionEnemies">0/0</span>
                    </div>
                    <div class="stat-row">
                        <span>Objectives Completed:</span>
                        <span id="intermissionObjectives">0/0</span>
                    </div>
                    <div class="stat-row">
                        <span>Squad Status:</span>
                        <span id="intermissionSquad">All Survived</span>
                    </div>
                    <div class="stat-row">
                        <span>Intel Collected:</span>
                        <span id="intermissionIntel" style="color: #00ffff;">0 documents</span>
                    </div>
                    <div class="stat-row">
                        <span>Research Points:</span>
                        <span id="intermissionResearch" style="color: #ff00ff;">+0</span>
                    </div>
                </div>
            </div>
            <div class="dialog-actions intermission-actions" id="intermissionActions">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Game Services (SOLID Architecture) -->
    <script src="js/services/formula-service.js"></script>
    <script src="js/services/research-service.js"></script>
    <script src="js/services/equipment-service.js"></script>
    <script src="js/services/inventory-service.js"></script>
    <script src="js/services/keybinding-service.js"></script>
    <script src="js/services/rpg-service.js"></script>
    <script src="js/services/game-services.js"></script>

    <!-- Flexible Engine System (interface and loader first) -->
    <script src="js/engine/campaign-interface.js"></script>
    <script src="js/engine/content-loader.js"></script>

    <!-- Game Modules - Load in sequence to preserve functionality -->
    <script src="js/game-core.js"></script>
    <script src="js/game-equipment.js"></script>
    <script src="js/game-eventlog.js"></script>
    <script src="js/game-teamcommands.js"></script>
    <script src="js/game-keyboard.js"></script>
    <script src="js/game-turnbased.js"></script>
    <script src="js/game-turnbased-render.js"></script>
    <script src="js/game-settings.js"></script>
    <!-- Hall of Glory Screen -->
    <div id="hallOfGlory" class="hub-screen" style="display: none;">
        <div class="hall-header">
            <div class="hall-title">‚ö∞Ô∏è HALL OF GLORY</div>
            <div class="hall-subtitle">Heroes who gave everything for the cause</div>
            <button class="back-button" onclick="game.showSyndicateHub()">‚Üê Back to Hub</button>
        </div>

        <div class="hall-content">
            <div id="noFallenMessage" class="empty-message">
                <div class="empty-icon">üéñÔ∏è</div>
                <div class="empty-text">No fallen heroes yet</div>
                <div class="empty-subtext">May your agents always return home</div>
            </div>

            <div id="fallenAgentsList" class="fallen-agents-grid">
                <!-- Fallen agents will be dynamically added here -->
            </div>
        </div>

        <div class="hall-footer">
            <div class="memorial-quote">
                "They shall grow not old, as we that are left grow old;<br>
                Age shall not weary them, nor the years condemn.<br>
                At the going down of the sun and in the morning<br>
                We will remember them."
            </div>
        </div>
    </div>

    <script src="js/game-events.js"></script>
    <!-- game-maps.js removed - all maps now embedded in mission files -->
    <script src="js/game-flow.js"></script>
    <script src="js/game-saveload.js"></script>
    <script src="js/game-hub.js"></script>
    <script src="js/game-hub-dialog-generators.js"></script>
    <script src="js/modal-engine.js"></script>
    <script src="js/dialog-manager.js"></script>
    <script src="js/declarative-dialog-engine.js"></script>
    <script src="js/dialog-config.js"></script>
    <script src="js/dialog-config-modals.js"></script>
    <script src="js/dialog-config-screens.js"></script>
    <script src="js/dialog-integration.js"></script>
    <script src="js/dialog-integration-modals.js"></script>
    <script src="js/dialog-integration-screens.js"></script>
    <script src="js/dialog-integration-additional.js"></script>

    <!-- Screen Manager System (for full-screen states) -->
    <script src="js/screen-manager.js"></script>
    <script src="js/screen-config.js"></script>

    <script src="js/game-dialogs.js"></script>
    <script src="js/game-npc.js"></script>
    <script src="js/game-screens.js"></script>
    <script src="js/game-demoscene.js"></script>
    <script src="js/game-audio.js"></script>
    <script src="js/game-audioloader.js"></script>
    <script src="js/game-music-config.js"></script>
    <script src="js/game-music-system.js"></script>
    <script src="js/game-screen-music.js"></script>

    <!-- RPG System -->
    <script src="js/game-rpg-system.js"></script>
    <script src="js/game-rpg-integration.js"></script>
    <script src="js/game-rpg-ui.js"></script>
    <script src="js/game-effects-config.js"></script>
    <script src="js/game-visual-effects.js"></script>

    <!-- Engine Integration (must load after CyberOpsGame is defined) -->
    <script src="js/engine/engine-integration.js"></script>
    <script src="js/game-loop.js"></script>
    <script src="js/game-pathfinding.js"></script>
    <script src="js/game-rendering.js"></script>
    <script src="js/game-3d.js"></script>
    <script src="js/game-utils.js"></script>

    <!-- Mission System -->
    <script src="js/campaign-system.js"></script>
    <!-- game-maps-data.js removed - maps now embedded in mission files -->
    <script src="js/game-mission-constants.js"></script>
    <script src="js/game-mission-executor.js"></script>
    <script src="js/game-mission-integration.js"></script>
    <script src="js/campaign-integration.js"></script>

    <!-- Campaign Configuration -->
    <script src="campaigns/main/campaign-content.js"></script>
    <script src="campaigns/main/campaign-config.js"></script>

    <script src="js/game-init.js"></script>

    <!-- Service Worker DISABLED - Causes caching issues during development -->
    <script>
        // DISABLED: Service worker causes caching confusion during development
        // To re-enable, uncomment the registration code below

        // First, unregister any existing service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister().then(function(success) {
                        if (success) {
                            console.log('üóëÔ∏è Service Worker unregistered successfully');
                        }
                    });
                }
            });

            // Clear all caches
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                        console.log('üóëÔ∏è Cache cleared:', name);
                    }
                });
            }
        }

        /* DISABLED SERVICE WORKER REGISTRATION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered:', registration);

                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute

                        // Handle updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available
                                    console.log('üîÑ New version available! Refresh to update.');

                                    // Show update notification to user
                                    if (window.game && window.game.showNotification) {
                                        window.game.showNotification('New version available! Refresh to update.', 'info');
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
        */

        // PWA Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;

            // Show install button if game has UI for it
            if (window.game && window.game.showInstallButton) {
                window.game.showInstallButton();
            }
        });

        // Handle install button click
        window.installPWA = async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to install prompt: ${outcome}`);
                deferredPrompt = null;
            }
        };

        // Detect if app was installed
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA was installed');
            deferredPrompt = null;
        });
    </script>
</body>
</html>