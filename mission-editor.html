<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberOps Mission Editor</title>
    <link rel="stylesheet" href="mission-editor.css">
</head>
<body>
    <div id="editor-container">
        <!-- Top Toolbar -->
        <div id="toolbar">
            <div class="toolbar-section">
                <button id="new-mission" class="toolbar-btn">üìÑ New</button>
                <button id="load-mission" class="toolbar-btn">üìÇ Load</button>
                <select id="load-game-mission" class="toolbar-btn" style="padding: 6px;">
                    <option value="">Loading campaigns...</option>
                </select>
                <button id="save-mission" class="toolbar-btn">üíæ Save</button>
                <button id="export-mission" class="toolbar-btn">üì§ Export</button>
                <button id="import-mission" class="toolbar-btn">üì• Import</button>
            </div>
            <div class="toolbar-section">
                <button id="test-mission" class="toolbar-btn primary">üéÆ Test Mission</button>
                <button id="validate-mission" class="toolbar-btn">‚úÖ Validate</button>
                <button id="campaign-config" class="toolbar-btn">üìö Campaign Config</button>
            </div>
            <div class="toolbar-section">
                <label>Grid: <input type="checkbox" id="show-grid" checked></label>
                <label>Snap: <input type="checkbox" id="snap-to-grid" checked></label>
                <label>Zoom: <input type="range" id="zoom-level" min="0.25" max="4" step="0.05" value="1"></label>
            </div>
        </div>

        <!-- Main Editor Area -->
        <div id="editor-main">
            <!-- Left Panel - Tools -->
            <div id="tools-panel">
                <div class="panel-header">Tools</div>

                <!-- Tile Tools -->
                <div class="tool-section">
                    <h3>Map Tiles</h3>
                    <div class="tool-grid">
                        <button class="tool-btn active" data-tool="floor" data-tile="0">
                            <div class="tool-preview floor"></div>
                            <span>Floor</span>
                        </button>
                        <button class="tool-btn" data-tool="wall" data-tile="1">
                            <div class="tool-preview wall"></div>
                            <span>Wall</span>
                        </button>
                        <button class="tool-btn" data-tool="door" data-tile="2">
                            <div class="tool-preview door"></div>
                            <span>Door</span>
                        </button>
                        <button class="tool-btn" data-tool="terminal" data-tile="3">
                            <div class="tool-preview terminal"></div>
                            <span>Terminal</span>
                        </button>
                        <button class="tool-btn" data-tool="cover" data-tile="4">
                            <div class="tool-preview cover"></div>
                            <span>Cover</span>
                        </button>
                    </div>
                </div>

                <!-- Entity Tools -->
                <div class="tool-section">
                    <h3>Entities</h3>
                    <div class="tool-grid">
                        <button class="tool-btn" data-tool="spawn-point">
                            <div class="tool-preview spawn"></div>
                            <span>Spawn</span>
                        </button>
                        <button class="tool-btn" data-tool="extraction">
                            <div class="tool-preview extraction"></div>
                            <span>Extract</span>
                        </button>
                        <button class="tool-btn" data-tool="enemy">
                            <div class="tool-preview enemy"></div>
                            <span>Enemy</span>
                        </button>
                        <button class="tool-btn" data-tool="npc">
                            <div class="tool-preview npc"></div>
                            <span>NPC</span>
                        </button>
                        <button class="tool-btn" data-tool="waypoint">
                            <div class="tool-preview waypoint"></div>
                            <span>Waypoint</span>
                        </button>
                        <button class="tool-btn" data-tool="item">
                            <div class="tool-preview item"></div>
                            <span>Item</span>
                        </button>
                        <button class="tool-btn" data-tool="explosive">
                            <div class="tool-preview explosive"></div>
                            <span>Explosive</span>
                        </button>
                        <button class="tool-btn" data-tool="switch">
                            <div class="tool-preview switch"></div>
                            <span>Switch</span>
                        </button>
                        <button class="tool-btn" data-tool="gate">
                            <div class="tool-preview gate"></div>
                            <span>Gate</span>
                        </button>
                    </div>
                </div>

                <!-- Brush Tools -->
                <div class="tool-section">
                    <h3>Brush Mode</h3>
                    <div class="tool-grid">
                        <button class="brush-btn active" data-brush="single">Single</button>
                        <button class="brush-btn" data-brush="line">Line</button>
                        <button class="brush-btn" data-brush="rect">Rectangle</button>
                        <button class="brush-btn" data-brush="fill">Fill</button>
                        <button class="brush-btn" data-brush="select">Select</button>
                        <button class="brush-btn" data-brush="erase">Erase</button>
                    </div>
                    <label>Size: <input type="range" id="brush-size" min="1" max="10" value="1"></label>
                </div>

                <!-- Quick Actions -->
                <div class="tool-section">
                    <h3>Quick Actions</h3>
                    <button class="action-btn" id="generate-room">üè¢ Generate Room</button>
                    <button class="action-btn" id="generate-corridor">üõ§Ô∏è Generate Corridor</button>
                    <button class="action-btn" id="clear-map">üóëÔ∏è Clear Map</button>
                    <button class="action-btn" id="auto-walls">üß± Auto Walls</button>
                </div>
            </div>

            <!-- Center - Map Canvas -->
            <div id="map-container">
                <canvas id="map-canvas"></canvas>
                <div id="entity-overlay"></div>
                <div id="selection-box"></div>
                <div id="coordinates">X: 0, Y: 0</div>
            </div>

            <!-- Right Panel - Properties -->
            <div id="properties-panel">
                <div class="panel-header">Properties</div>

                <!-- Mission Properties -->
                <div class="properties-section" id="mission-properties">
                    <h3>Mission Settings</h3>
                    <label>Name: <input type="text" id="mission-name" value="New Mission"></label>
                    <label>Description: <textarea id="mission-desc" rows="3"></textarea></label>
                    <label>Map Type:
                        <select id="map-type">
                            <option value="corporate">Corporate</option>
                            <option value="government">Government</option>
                            <option value="industrial">Industrial</option>
                            <option value="slums">Slums</option>
                            <option value="research">Research</option>
                            <option value="custom">Custom</option>
                        </select>
                    </label>
                    <label>Width: <input type="number" id="map-width" value="80" min="20" max="200"></label>
                    <label>Height: <input type="number" id="map-height" value="80" min="20" max="200"></label>
                    <label>Difficulty:
                        <select id="mission-difficulty">
                            <option value="1">Easy</option>
                            <option value="2">Normal</option>
                            <option value="3">Hard</option>
                            <option value="4">Expert</option>
                            <option value="5">Nightmare</option>
                        </select>
                    </label>
                    <label>Time Limit: <input type="number" id="time-limit" value="0" min="0"> seconds</label>
                    <label>Credits Reward: <input type="number" id="credits-reward" value="5000" min="0"></label>
                    <label>Research Reward: <input type="number" id="research-reward" value="2" min="0"></label>

                    <h3>Campaign Structure</h3>
                    <label>Campaign:
                        <select id="campaign-id">
                            <option value="main">Main Campaign</option>
                            <option value="dlc1">DLC: Corporate Wars</option>
                            <option value="custom">Custom Missions</option>
                            <option value="tutorial">Tutorial</option>
                        </select>
                    </label>
                    <label>Act Number: <input type="text" id="act-number" value="01" pattern="[0-9]{2}" maxlength="2"></label>
                    <label>Mission Number: <input type="text" id="mission-number" value="001" pattern="[0-9]{3}" maxlength="3"></label>
                    <label>Act Name: <input type="text" id="act-name" value="Act 1"></label>

                    <h3>Agent Settings</h3>
                    <label>Max Agents: <input type="number" id="max-agents" value="4" min="1" max="6"></label>
                    <label>Required Agents: <input type="number" id="required-agents" value="2" min="1" max="6"></label>
                    <label>Recommended: <input type="number" id="recommended-agents" value="3" min="1" max="6"></label>

                    <h3>Turn-Based Mode Settings</h3>
                    <label>Enable Turn-Based: <input type="checkbox" id="tb-enabled"></label>
                    <label>Force Turn-Based: <input type="checkbox" id="tb-forced"></label>
                    <label>Default Agent AP: <input type="number" id="tb-default-ap" value="12" min="1" max="20"></label>
                    <label>Initiative Mode:
                        <select id="tb-initiative">
                            <option value="speed">Speed-based</option>
                            <option value="random">Random</option>
                            <option value="player-first">Player First</option>
                            <option value="enemy-first">Enemy First</option>
                        </select>
                    </label>
                </div>

                <!-- Selected Entity Properties -->
                <div class="properties-section" id="entity-properties" style="display:none;">
                    <h3>Entity Properties</h3>
                    <div id="entity-props-content"></div>
                </div>

                <!-- Objectives Editor -->
                <div class="properties-section">
                    <h3>Mission Objectives</h3>
                    <div id="objectives-list"></div>
                    <button class="action-btn" id="add-objective">+ Add Objective</button>
                </div>

                <!-- NPCs and Dialogs -->
                <div class="properties-section">
                    <h3>NPCs & Dialogs</h3>
                    <div id="npcs-list"></div>
                    <button class="action-btn" id="add-npc">+ Add NPC</button>
                </div>
            </div>
        </div>

        <!-- Bottom Panel - Timeline/Events -->
        <div id="bottom-panel">
            <div class="panel-header">
                <span>Events & Triggers</span>
                <button class="minimize-btn" id="toggle-bottom">‚ñº</button>
            </div>
            <div id="events-content">
                <div id="events-timeline"></div>
                <button class="action-btn" id="add-event">+ Add Event</button>
            </div>
        </div>
    </div>

    <!-- Dialogs -->
    <div id="objective-dialog" class="dialog" style="display:none;">
        <div class="dialog-content">
            <h2>Edit Objective</h2>
            <label>Type:
                <select id="obj-type">
                    <option value="interact">Interact</option>
                    <option value="eliminate">Eliminate</option>
                    <option value="collect">Collect</option>
                    <option value="reach">Reach</option>
                    <option value="survive">Survive</option>
                    <option value="defend">Defend</option>
                    <option value="escort">Escort</option>
                    <option value="custom">Custom</option>
                </select>
            </label>
            <label>Target: <input type="text" id="obj-target"></label>
            <label>Count: <input type="number" id="obj-count" value="1" min="1"></label>
            <label>Description: <textarea id="obj-desc" rows="2"></textarea></label>
            <label>Required: <input type="checkbox" id="obj-required" checked></label>
            <label>Hidden: <input type="checkbox" id="obj-hidden"></label>
            <div class="dialog-buttons">
                <button id="save-objective">Save</button>
                <button id="cancel-objective">Cancel</button>
            </div>
        </div>
    </div>

    <div id="npc-dialog" class="dialog" style="display:none;">
        <div class="dialog-content">
            <h2>Edit NPC</h2>
            <label>Name: <input type="text" id="npc-name"></label>
            <label>Type:
                <select id="npc-type">
                    <option value="civilian">Civilian</option>
                    <option value="informant">Informant</option>
                    <option value="merchant">Merchant</option>
                    <option value="guard">Guard</option>
                    <option value="scientist">Scientist</option>
                    <option value="hacker">Hacker</option>
                </select>
            </label>
            <label>Position: X: <input type="number" id="npc-x" min="0"> Y: <input type="number" id="npc-y" min="0"></label>

            <h3>RPG Stats</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <label>Level: <input type="number" id="npc-level" value="1" min="1" max="20"></label>
                <label>Class:
                    <select id="npc-class">
                        <option value="">None</option>
                        <option value="civilian">Civilian</option>
                        <option value="soldier">Soldier</option>
                        <option value="infiltrator">Infiltrator</option>
                        <option value="tech">Tech Specialist</option>
                        <option value="medic">Medic</option>
                    </select>
                </label>
                <label>Health: <input type="number" id="npc-health" value="100" min="1" max="500"></label>
                <label>AP (Turn-based): <input type="number" id="npc-ap" value="8" min="1" max="20"></label>
                <label>Strength: <input type="number" id="npc-strength" value="10" min="1" max="20"></label>
                <label>Agility: <input type="number" id="npc-agility" value="10" min="1" max="20"></label>
                <label>Intelligence: <input type="number" id="npc-intelligence" value="10" min="1" max="20"></label>
                <label>Charisma: <input type="number" id="npc-charisma" value="10" min="1" max="20"></label>
            </div>

            <h3>Dialog Tree</h3>
            <div id="dialog-tree-editor">
                <textarea id="npc-dialog" rows="10" placeholder="Enter dialog in JSON format"></textarea>
            </div>

            <h3>Quests</h3>
            <div id="npc-quests">
                <textarea id="npc-quests-data" rows="5" placeholder="Enter quests in JSON format"></textarea>
            </div>

            <div class="dialog-buttons">
                <button id="save-npc">Save</button>
                <button id="cancel-npc">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Enemy Dialog -->
    <div id="enemy-dialog" class="dialog" style="display:none;">
        <div class="dialog-content">
            <h2>Edit Enemy</h2>
            <label>Enemy Type:
                <select id="enemy-type">
                    <option value="guard">Guard</option>
                    <option value="soldier">Soldier</option>
                    <option value="heavy">Heavy</option>
                    <option value="sniper">Sniper</option>
                    <option value="elite">Elite</option>
                    <option value="boss">Boss</option>
                </select>
            </label>
            <label>Position: X: <input type="number" id="enemy-x" min="0"> Y: <input type="number" id="enemy-y" min="0"></label>

            <h3>RPG Stats</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <label>Level: <input type="number" id="enemy-level" value="1" min="1" max="20"></label>
                <label>Health: <input type="number" id="enemy-health" value="100" min="1" max="1000"></label>
                <label>AP (Turn-based): <input type="number" id="enemy-ap" value="8" min="1" max="20"></label>
                <label>Damage: <input type="number" id="enemy-damage" value="10" min="1" max="100"></label>
                <label>Armor: <input type="number" id="enemy-armor" value="0" min="0" max="50"></label>
                <label>Vision Range: <input type="number" id="enemy-vision" value="10" min="1" max="20"></label>
                <label>Movement Speed: <input type="number" id="enemy-speed" step="0.1" value="2.0" min="0.5" max="5"></label>
                <label>Alert Range: <input type="number" id="enemy-alert-range" value="15" min="5" max="30"></label>
            </div>

            <h3>Behavior</h3>
            <label>AI Type:
                <select id="enemy-ai">
                    <option value="patrol">Patrol</option>
                    <option value="stationary">Stationary</option>
                    <option value="aggressive">Aggressive</option>
                    <option value="defensive">Defensive</option>
                    <option value="sniper">Sniper</option>
                </select>
            </label>
            <label>Patrol Route (JSON): <textarea id="enemy-patrol" rows="3" placeholder="[[x1,y1], [x2,y2], ...]">[]</textarea></label>

            <div class="dialog-buttons">
                <button id="save-enemy">Save</button>
                <button id="cancel-enemy">Cancel</button>
            </div>
        </div>
    </div>

    <!-- File Input for Loading -->
    <input type="file" id="file-input" accept=".json" style="display:none;">

    <!-- Campaign Management Dialog -->
    <div id="campaign-dialog" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 1000;">
        <div style="background: #1a1a2e; border: 2px solid #00ff41; border-radius: 8px; padding: 20px; max-width: 95%; width: 1200px; margin: 20px auto; max-height: 95vh; overflow-y: auto;">
            <h2 style="color: #00ff41; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                <span>üìö Campaign Management System</span>
                <button id="campaign-close" style="background: #ff073a; color: white; border: none; padding: 5px 15px; cursor: pointer; border-radius: 4px;">‚úñ Close</button>
            </h2>

            <!-- Tab Navigation -->
            <div style="display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #00ff41;">
                <button class="campaign-tab active" data-tab="overview" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Overview</button>
                <button class="campaign-tab" data-tab="missions" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Missions</button>
                <button class="campaign-tab" data-tab="agents" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Agents</button>
                <button class="campaign-tab" data-tab="weapons" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Weapons & Equipment</button>
                <button class="campaign-tab" data-tab="enemies" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Enemy Types</button>
                <button class="campaign-tab" data-tab="research" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Research Tree</button>
                <button class="campaign-tab" data-tab="intel" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Intel & Story</button>
                <button class="campaign-tab" data-tab="music" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Music & Audio</button>
                <button class="campaign-tab" data-tab="rpg" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">RPG Config</button>
                <button class="campaign-tab" data-tab="formulas" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Formulas</button>
                <button class="campaign-tab" data-tab="theme" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Theme & UI</button>
                <button class="campaign-tab" data-tab="inventory" style="background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; border-bottom: none; padding: 10px 20px; cursor: pointer;">Inventory</button>
            </div>

            <!-- Tab Content Areas -->
            <div id="campaign-tabs-content">
                <!-- Overview Tab -->
                <div id="tab-overview" class="campaign-tab-content" style="display: block;">
                    <h3>Campaign Management</h3>

                    <!-- Campaign Selector -->
                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(0,255,65,0.1); border: 1px solid #00ff41; border-radius: 5px;">
                        <h4 style="color: #00ff41; margin-top: 0;">üìö Campaign Library</h4>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="campaign-selector" style="flex: 1; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 8px; font-size: 14px;">
                                <option value="">Loading campaigns...</option>
                            </select>
                            <button id="campaign-switch" style="padding: 8px 15px; background: #00ffff; color: #1a1a2e; border: none; cursor: pointer; border-radius: 4px;">üîÑ Load Campaign</button>
                            <button id="campaign-delete" style="padding: 8px 15px; background: #ff073a; color: white; border: none; cursor: pointer; border-radius: 4px;">üóëÔ∏è Delete</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4>Campaign Actions</h4>
                            <button id="campaign-new" style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">üÜï Create New Campaign</button>
                            <button id="campaign-duplicate" style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">üìã Duplicate Current Campaign</button>
                            <button id="campaign-import-zip" style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">üì¶ Import Campaign (ZIP)</button>
                            <button id="campaign-import-dir" style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">üìÅ Import Campaign (Folder)</button>
                            <button id="campaign-export-zip" style="display: block; width: 100%; margin: 5px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">üíæ Export Campaign (ZIP)</button>
                        </div>
                        <div>
                            <h4>Basic Settings</h4>
                            <label style="display: block; margin: 10px 0;">
                                Campaign ID: <input type="text" id="campaign-id-edit" value="main" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;">
                            </label>
                            <label style="display: block; margin: 10px 0;">
                                Campaign Name: <input type="text" id="campaign-name-edit" value="Corporate Domination" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;">
                            </label>
                            <label style="display: block; margin: 10px 0;">
                                Description: <textarea id="campaign-desc" rows="3" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;">Take control of the city's corporate infrastructure</textarea>
                            </label>
                            <button id="campaign-save-overview" style="display: block; width: 100%; margin: 10px 0; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; font-weight: bold;">üíæ Save Campaign to Storage</button>
                            <div id="save-status" style="margin: 5px 0; padding: 5px; color: #88ff88; text-align: center; font-size: 12px;"></div>
                        </div>
                    </div>

                    <h4>Starting Resources</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <label>Credits: <input type="number" id="start-credits" value="10000" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;"></label>
                        <label>Research Points: <input type="number" id="start-research" value="150" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;"></label>
                        <label>World Control: <input type="number" id="start-control" value="15" style="width: 100%; background: #0a0e27; color: #00ff41; border: 1px solid #00ff41; padding: 5px;"></label>
                    </div>
                </div>

                <!-- Missions Tab -->
                <div id="tab-missions" class="campaign-tab-content" style="display: none;">
                    <h3>Mission Structure</h3>

                    <!-- Mission Controls -->
                    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                        <button id="add-mission" style="padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add New Mission</button>
                        <button id="add-act" style="padding: 10px; background: #00ffff; color: #1a1a2e; border: none; cursor: pointer;">üìÅ Add New Act</button>
                        <button id="reorder-missions" style="padding: 10px; background: #ff9800; color: white; border: none; cursor: pointer;">üîÑ Reorder Missions</button>
                        <button id="import-mission-file" style="padding: 10px; background: #9c27b0; color: white; border: none; cursor: pointer;">üì• Import Mission File</button>
                    </div>

                    <!-- Mission Structure Display -->
                    <div id="campaign-structure" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with campaign structure -->
                    </div>
                </div>

                <!-- Agents Tab -->
                <div id="tab-agents" class="campaign-tab-content" style="display: none;">
                    <h3>Campaign Agents</h3>
                    <button id="add-agent" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add New Agent</button>
                    <div id="agents-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with agents -->
                    </div>
                </div>

                <!-- Weapons & Equipment Tab -->
                <div id="tab-weapons" class="campaign-tab-content" style="display: none;">
                    <h3>Weapons & Equipment</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4>Weapons</h4>
                            <button id="add-weapon" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add Weapon</button>
                            <div id="weapons-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated with weapons -->
                            </div>
                        </div>
                        <div>
                            <h4>Equipment</h4>
                            <button id="add-equipment" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add Equipment</button>
                            <div id="equipment-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated with equipment -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enemy Types Tab -->
                <div id="tab-enemies" class="campaign-tab-content" style="display: none;">
                    <h3>Enemy Types</h3>
                    <button id="add-enemy" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add Enemy Type</button>
                    <div id="enemies-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with enemy types -->
                    </div>
                </div>

                <!-- Research Tree Tab -->
                <div id="tab-research" class="campaign-tab-content" style="display: none;">
                    <h3>Research Tree</h3>
                    <button id="add-research" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add Research Item</button>
                    <div id="research-tree" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with research tree -->
                    </div>
                </div>

                <!-- Intel & Story Tab -->
                <div id="tab-intel" class="campaign-tab-content" style="display: none;">
                    <h3>Intel Reports & Story</h3>
                    <button id="add-intel" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer;">‚ûï Add Intel Report</button>
                    <div id="intel-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with intel reports -->
                    </div>
                </div>

                <!-- Music & Audio Tab -->
                <div id="tab-music" class="campaign-tab-content" style="display: none;">
                    <h3>Music & Audio Configuration</h3>
                    <div id="music-config" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 500px; overflow-y: auto;">
                        <!-- Will be populated with music configuration -->
                    </div>
                </div>

                <!-- RPG Configuration Tab -->
                <div id="tab-rpg" class="campaign-tab-content" style="display: none;">
                    <h3>RPG System Configuration</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <!-- Classes Section -->
                        <div>
                            <h4 style="color: #00ff41;">Character Classes</h4>
                            <button id="add-class" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 100%;">‚ûï Add Class</button>
                            <div id="classes-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated with classes -->
                            </div>
                        </div>

                        <!-- Skills Section -->
                        <div>
                            <h4 style="color: #00ff41;">Skills</h4>
                            <button id="add-skill" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 100%;">‚ûï Add Skill</button>
                            <div id="skills-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated with skills -->
                            </div>
                        </div>

                        <!-- Stats Section -->
                        <div>
                            <h4 style="color: #00ff41;">Primary Stats</h4>
                            <button id="add-stat" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 100%;">‚ûï Add Stat</button>
                            <div id="stats-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated with stats -->
                            </div>
                        </div>
                    </div>

                    <!-- Items Section -->
                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff41;">RPG Items & Equipment</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h5>Armor Types</h5>
                                <button id="add-armor" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 100%;">‚ûï Add Armor</button>
                                <div id="armor-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto;">
                                    <!-- Will be populated with armor -->
                                </div>
                            </div>
                            <div>
                                <h5>Consumables</h5>
                                <button id="add-consumable" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 100%;">‚ûï Add Consumable</button>
                                <div id="consumables-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 200px; overflow-y: auto;">
                                    <!-- Will be populated with consumables -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formulas Tab -->
                <div id="tab-formulas" class="campaign-tab-content" style="display: none;">
                    <h3>Combat & Game Formulas</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #00ff41;">Damage Calculations</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    Base Damage Formula:
                                    <input type="text" id="formula-damage" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;"
                                           value="baseDamage + weaponDamage + (strength / 2)" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Critical Hit Multiplier:
                                    <input type="number" id="formula-crit" step="0.1" min="1" max="5" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="2.0" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Armor Reduction Formula:
                                    <input type="text" id="formula-armor" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;"
                                           value="damage * (100 / (100 + armor))" />
                                </label>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: #00ff41;">Experience & Leveling</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    XP Per Level Formula:
                                    <input type="text" id="formula-xp" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;"
                                           value="level * 100 + (level * level * 50)" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Skill Points Per Level:
                                    <input type="number" id="formula-skillpoints" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="3" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Max Level:
                                    <input type="number" id="formula-maxlevel" min="1" max="100" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="20" />
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff41;">Turn-Based Mode Settings</h4>
                        <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                <label>
                                    Default Agent AP:
                                    <input type="number" id="tb-agent-ap" min="1" max="20" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="12" />
                                </label>
                                <label>
                                    Default Enemy AP:
                                    <input type="number" id="tb-enemy-ap" min="1" max="20" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="8" />
                                </label>
                                <label>
                                    Move Cost (per tile):
                                    <input type="number" id="tb-move-cost" min="1" max="5" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="1" />
                                </label>
                                <label>
                                    Shoot Cost:
                                    <input type="number" id="tb-shoot-cost" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="4" />
                                </label>
                                <label>
                                    Ability Cost:
                                    <input type="number" id="tb-ability-cost" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="6" />
                                </label>
                                <label>
                                    Hack Cost:
                                    <input type="number" id="tb-hack-cost" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="4" />
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Theme & UI Tab -->
                <div id="tab-theme" class="campaign-tab-content" style="display: none;">
                    <h3>Campaign Theme & UI Configuration</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #00ff41;">Color Scheme</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    Primary Color:
                                    <input type="color" id="theme-primary" style="width: 100%; height: 40px; background: #1a1a2e; border: 1px solid #00ff41;" value="#00ff41" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Secondary Color:
                                    <input type="color" id="theme-secondary" style="width: 100%; height: 40px; background: #1a1a2e; border: 1px solid #00ff41;" value="#00ffff" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Danger Color:
                                    <input type="color" id="theme-danger" style="width: 100%; height: 40px; background: #1a1a2e; border: 1px solid #00ff41;" value="#ff073a" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Background Color:
                                    <input type="color" id="theme-background" style="width: 100%; height: 40px; background: #1a1a2e; border: 1px solid #00ff41;" value="#0a0e27" />
                                </label>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: #00ff41;">UI Strings</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    Currency Name:
                                    <input type="text" id="ui-currency" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="Credits" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Research Points Name:
                                    <input type="text" id="ui-research" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="Research Points" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Agent/Unit Name:
                                    <input type="text" id="ui-agent" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="Agent" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Enemy Name:
                                    <input type="text" id="ui-enemy" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="Enemy" />
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff41;">Gameplay Constants</h4>
                        <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                                <label>
                                    Movement Speed:
                                    <input type="number" id="const-movespeed" step="0.1" min="0.1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="2.0" />
                                </label>
                                <label>
                                    Vision Range:
                                    <input type="number" id="const-vision" min="1" max="20" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="10" />
                                </label>
                                <label>
                                    Hack Range:
                                    <input type="number" id="const-hackrange" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="3" />
                                </label>
                                <label>
                                    Max Squad Size:
                                    <input type="number" id="const-squadsize" min="1" max="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="6" />
                                </label>
                                <label>
                                    Base Health:
                                    <input type="number" id="const-health" min="10" max="500" step="10" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="100" />
                                </label>
                                <label>
                                    Respawn Timer (sec):
                                    <input type="number" id="const-respawn" min="0" max="60" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="0" />
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Management Tab -->
                <div id="tab-inventory" class="campaign-tab-content" style="display: none;">
                    <h3>Agent Inventory & Loadout Management</h3>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #00ff41;">Default Agent Loadouts</h4>
                        <button id="add-loadout" style="margin-bottom: 10px; padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; width: 200px;">‚ûï Add Agent Loadout</button>
                        <div id="loadouts-list" style="background: #0a0e27; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto;">
                            <!-- Will be populated with agent loadouts -->
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: #00ff41;">Inventory Settings</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    Default Carry Weight:
                                    <input type="number" id="inv-carry-weight" min="10" max="500" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="100" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Weight Penalty Speed Reduction %:
                                    <input type="number" id="inv-weight-penalty" min="0" max="100" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="50" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Max Inventory Slots:
                                    <input type="number" id="inv-max-slots" min="10" max="100" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="30" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Stack Size (consumables):
                                    <input type="number" id="inv-stack-size" min="1" max="999" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="99" />
                                </label>
                            </div>
                        </div>

                        <div>
                            <h4 style="color: #00ff41;">Starting Inventory</h4>
                            <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                                <label style="display: block; margin-bottom: 10px;">
                                    Starting Credits:
                                    <input type="number" id="inv-start-credits" min="0" max="99999" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="1000" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Starting Ammo (Primary):
                                    <input type="number" id="inv-start-ammo-primary" min="0" max="999" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="120" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Starting Ammo (Secondary):
                                    <input type="number" id="inv-start-ammo-secondary" min="0" max="999" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="60" />
                                </label>
                                <label style="display: block; margin-bottom: 10px;">
                                    Starting Medkits:
                                    <input type="number" id="inv-start-medkits" min="0" max="99" style="width: 100%; padding: 5px; background: #1a1a2e; color: #00ff41; border: 1px solid #00ff41;" value="3" />
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4 style="color: #00ff41;">Quick Item Sets</h4>
                        <div style="background: #0a0e27; padding: 15px; border-radius: 4px;">
                            <button id="create-item-set" style="padding: 10px; background: #00ff41; color: #1a1a2e; border: none; cursor: pointer; margin-right: 10px;">Create Item Set</button>
                            <button id="save-inventory-config" style="padding: 10px; background: #00ffff; color: #1a1a2e; border: none; cursor: pointer;">Save Inventory Config</button>
                            <div id="item-sets-list" style="margin-top: 10px;">
                                <!-- Will be populated with item sets -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Changes Button -->
            <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #00ff41;">
                <button id="campaign-save" style="background: #00ff41; color: #1a1a2e; border: none; padding: 15px 40px; margin: 0 5px; cursor: pointer; font-size: 16px; font-weight: bold;">üíæ Save All Changes</button>
            </div>
        </div>
    </div>

    <!-- Hidden file inputs for imports -->
    <input type="file" id="import-zip-input" accept=".zip" style="display:none;">
    <input type="file" id="import-dir-input" webkitdirectory directory multiple style="display:none;">

    <!-- Initialize CAMPAIGN_MISSIONS global -->
    <script>
        window.CAMPAIGN_MISSIONS = window.CAMPAIGN_MISSIONS || {};
    </script>

    <!-- Load JSZip library for ZIP export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Services (needed for RPG and equipment systems) -->
    <script src="js/services/formula-service.js"></script>
    <script src="js/services/research-service.js"></script>
    <script src="js/services/equipment-service.js"></script>
    <script src="js/services/keybinding-service.js"></script>
    <script src="js/services/rpg-service.js"></script>
    <script src="js/services/game-services.js"></script>

    <!-- Engine -->
    <script src="js/engine/content-loader.js"></script>

    <!-- Core game modules -->
    <script src="js/game-mission-constants.js"></script>
    <script src="js/campaign-system.js"></script>

    <!-- Load campaign system for editor -->
    <script src="js/campaign-loader-editor.js"></script>

    <!-- Editor script -->
    <script src="mission-editor.js"></script>
</body>
</html>